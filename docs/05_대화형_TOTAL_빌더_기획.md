# 05. 대화형 TOTAL 빌더 기획 (학교별 문제점 분석용 데이터 입력)

**작성일**: 2025-02-28  
**목적**: 학교별 문제점 분석 파일 생성에 쓰이는 `DNI_TOTAL_MEASURE_LIST_V1.xlsx`(또는 TOTAL_MEASURE_LIST_V1.xlsx)에 **측정 데이터 외 다른 데이터도 넣을 수 있도록** 대화형 프로그램을 만들기 위한 기획.

---

## 1. 배경·목표

### 1.1 현재까지의 흐름

- **측정 데이터 전처리** 후 `DNI_TOTAL_MEASURE_LIST_V1.xlsx`에 데이터를 넣어 두었음.
- 이 TOTAL 파일은 **학교별 리포트 생성기**(`dni_school_report_generator.py`, `school_report_generator_v1_1.py`)에서 **문제점분석** 시트의 J열(측정값)·L열(판정) 등을 채우는 **통계 입력**으로 사용됨.
- TOTAL 파일은 **여러 시트**로 구성됨  
  (예: 전부하측정_학교별평균, ISP측정_학교별평균, 학교별통신장비현황, POE, 케이블통계, AP_장비통계 등).

### 1.2 이번에 하고 싶은 것

- **다른 데이터**도 TOTAL에 넣을 수 있게 하고 싶음.
  - 예: 추가 설문/점검 결과, 외부 엑셀 시트, 학교별 요약 테이블 등.
- 이를 **대화형으로** 할 수 있게 하고 싶음.
  - 사용자가 실행 시 **어떤 데이터(파일·시트)를 넣을지 선택**하고,  
    **TOTAL 출력 파일명/경로**를 지정해 한 번에 반영하는 방식.

### 1.3 목표 정리

| 구분 | 내용 |
|------|------|
| **주요 목표** | TOTAL xlsx에 **측정 데이터 + 그 외 데이터**를 대화형으로 선택·추가할 수 있는 프로그램 기획 및 구현 방향 수립 |
| **대상 사용자** | DNI/CNE 학교별 문제점 분석을 수행하는 운영자 |
| **산출물** | 하나의 TOTAL xlsx (기존 리포트 생성기가 그대로 참조 가능한 형식 유지) |

---

## 2. 현재 구조와 한계

### 2.1 DNI 측정 자료 빌더 (`dni_measure_builder.py`)

- **하는 일**
  1. ISP 처리(meansure → measure, 315학교 병합)
  2. 전부하 처리(2차 복사, 최종 선정)
  3. **TOTAL 파일명 선택 저장**: 사용자가 “원본 TOTAL” 파일을 고르면, 그 파일을 **그대로 복사**해 `DNI_TOTAL_MEASURE_LIST_V1.xlsx` 등으로 저장
- **한계**
  - TOTAL **내용을 조합·편집하지 않음**. “원본 TOTAL” 하나를 골라 복사만 함.
  - 시트 단위로 “이 시트 추가 / 저 시트 제외” 같은 **선택 불가**.
  - **다른 종류의 데이터**(설문, 점검표, 외부 엑셀 시트 등)를 **대화형으로 추가**하는 기능 없음.

### 2.2 충남 TOTAL 빌더 (`build_total_measure_list_v1_1.py`)

- **하는 일**
  - 정해진 `SOURCES` 리스트(파일 경로 + 시트명)를 순회하며, **파일·시트가 존재하면** 해당 시트를 TOTAL에 **복사**.
- **한계**
  - 소스 목록이 **코드에 하드코딩**. 대화형 선택 없음.
  - DNI 쪽과 통합된 “한 번에 선택해서 TOTAL 만드는” 흐름이 아님.

### 2.3 TOTAL 시트 규약 (리포트 생성기 가정)

- 각 시트는 **학교 단위**로 매핑되며, **학교코드** 열(보통 A열 또는 2열 등)로 행을 식별.
- 리포트 생성기는 TOTAL의 **시트 이름**과 **열 이름/위치**에 맞춰 문제점분석 시트를 채움.
- 따라서 “다른 데이터”를 넣을 때도 **시트명·학교코드 열** 규약을 맞추면 기존 리포트 로직을 그대로 쓸 수 있음.

---

## 3. 대화형 프로그램 기획

### 3.1 기능 범위 (제안)

| 번호 | 기능 | 설명 |
|------|------|------|
| F1 | **데이터 소스 선택** | 엑셀 파일(경로) + 시트 이름을 **대화형으로** 선택. 여러 개 선택 가능. |
| F2 | **기본 시트 목록 제공** | 현재 사용 중인 “기본” 시트 목록(전부하측정_학교별평균, ISP측정_학교별평균, 학교별통신장비현황 등)을 제안하고, 그에 대응하는 기본 소스 파일 후보를 보여 줌. |
| F3 | **사용자 정의 시트 추가** | 기본 목록에 없는 **임의 엑셀 파일·시트**를 지정해 TOTAL에 시트로 추가. (학교코드 열이 있으면 리포트와 연동 가능) |
| F4 | **TOTAL 출력 지정** | 출력 파일명/경로 지정 (예: `DNI_TOTAL_MEASURE_LIST_V1.xlsx` 또는 사용자 지정). |
| F5 | **기존 TOTAL 불러오기(선택)** | 이미 있는 TOTAL을 “베이스”로 불러와, 그 위에 시트 추가/덮어쓰기 옵션. |
| F6 | **실행·저장** | 선택한 소스들로 TOTAL xlsx를 생성·저장. |

### 3.2 데이터 소스 확장

- **1차**: 기존과 동일하게 **엑셀(.xlsx/.xlsm)의 특정 시트**를 시트 단위로 TOTAL에 복사.
- **2차(선택)**  
  - CSV 등 다른 형식에서 “학교코드 + 값” 테이블을 읽어 **새 시트로 추가**.  
  - 또는 “빈 시트 템플릿 + 나중에 수동 입력”용 시트를 TOTAL에 추가하는 옵션.

소스 종류는 **플러그인/등록 테이블** 형태로 확장 가능하게 설계하면, 나중에 “설문 결과”, “점검 결과” 등을 유형별로 추가하기 쉬움.

### 3.3 UI 방식 제안

- **1단계(권장)**: **CLI 대화형**
  - 터미널에서 번호/경로 입력으로 “소스 선택 → 출력 경로 지정 → 실행”.
  - 현재 `dni_measure_builder.py`의 `_pick_file`, `_input` 패턴을 확장해, “시트 목록 선택”“추가 시트 경로+시트명 입력” 등을 넣는 방식.
- **2단계(선택)**: **단순 GUI**
  - 파일/시트 목록을 리스트로 보여 주고, 체크박스로 선택 후 “TOTAL 생성” 버튼으로 실행.
  - Tkinter 또는 PyQt 등으로 경량 도구 구현 가능.

우선 **CLI 대화형**으로 기획·구현하고, 필요 시 GUI를 감싸는 형태로 확장하는 흐름을 권장.

### 3.4 출력

- **파일**: 하나의 xlsx (`DNI_TOTAL_MEASURE_LIST_V1.xlsx` 또는 사용자 지정).
- **내용**: 선택된 각 “소스(파일+시트)”가 **동일 시트명**으로 TOTAL에 포함.  
  (기존 리포트 생성기는 경로만 맞추면 그대로 사용 가능.)

---

## 4. 단계별 작업 계획 (오늘 계획)

아래는 **기획 단계**에서 정리한 “할 일” 목록입니다. 실제 구현 시 순서와 세부 항목은 조정 가능합니다.

### 4.1 1단계: 요구사항·스펙 고정

- [ ] **데이터 소스 목록 문서화**  
  - DNI/CNE에서 TOTAL에 넣을 수 있는 “다른 데이터” 후보를 리스트업 (파일명·시트명·의미).
- [ ] **시트명·학교코드 규약 정리**  
  - 리포트 생성기가 참조하는 시트명·열 구조를 한 곳에 정리 (또는 `02_통합DB_실데이터_시트_정의.md`에 TOTAL 전용 섹션 추가).
- [ ] **대화형에서 선택 가능한 옵션 목록**  
  - “기본 시트 묶음(DNI/CNE)”, “파일+시트 직접 입력”, “기존 TOTAL 베이스 사용” 등.

### 4.2 2단계: 설계

- [ ] **모듈 역할 분리**  
  - “소스 목록/기본값 관리”, “파일·시트 선택 로직”, “TOTAL 시트 복사/병합”, “출력 저장”을 나누어 설계.
- [ ] **기존 코드와의 관계**  
  - `dni_measure_builder.py`: TOTAL 복사만 담당 → 새 “대화형 TOTAL 빌더”가 TOTAL **생성/편집**을 담당하고, 기존 빌더는 “ISP/전부하만 실행 후, TOTAL은 새 도구에서 조합”하는 흐름으로 정리할지 결정.
  - `build_total_measure_list_v1_1.py`: SOURCES를 “설정/대화형 선택”으로 옮길지, 아니면 새 스크립트가 이 로직을 호출할지 결정.

### 4.3 3단계: 구현 (다음 작업일 등)

- [ ] **대화형 TOTAL 빌더 스크립트 초안**  
  - 소스(파일+시트) 선택 → 출력 경로 지정 → TOTAL 생성까지 CLI로 동작.
- [ ] **기본 시트/기본 소스 설정**  
  - DNI용, CNE용 “기본 후보”를 설정 파일(JSON 등) 또는 코드 상 상수로 두고, 대화형에서 번호로 선택 가능하게.
- [ ] **기존 TOTAL 로드 후 시트 추가**  
  - 선택 사항: 기존 TOTAL을 열어 그 위에 시트만 추가하는 모드.
- [ ] **문서·실행 방법**  
  - `docs/04_사전조사_실행방법.md` 또는 새 문서에 “대화형 TOTAL 빌더 사용법” 추가.

### 4.4 4단계: 연동·테스트

- [ ] **리포트 생성기와 연동 확인**  
  - 새로 만든 TOTAL로 `dni_school_report_generator.py` / `school_report_generator_v1_1.py` 실행 시 문제점분석 시트가 정상 채워지는지 확인.
- [ ] **다른 데이터 시트 추가 시나리오**  
  - “추가 엑셀 1개 시트”를 TOTAL에 넣고, 리포트 생성 시 해당 시트가 참조되는지(또는 최소한 오류 없이 동작하는지) 확인.

---

## 5. 오늘 할 일 요약 (계획만)

- [x] **기획서 작성** (본 문서)
- [ ] **데이터 소스 후보 리스트업** (어떤 “다른 데이터”를 넣을지 구체화)
- [ ] **대화형 옵션 목록 최종 확인** (기본 시트 묶음 / 직접 입력 / 베이스 TOTAL 사용 여부)
- [ ] **다음 작업일**  
  - 설계(모듈 분리, 기존 코드와 역할 정리) → 구현(CLI 대화형 TOTAL 빌더 초안) 순으로 진행.

---

## 6. 참고

- **TOTAL 사용처**: `dni_school_report_config.py`, `dni_school_report_generator.py`, `school_report_generator_v1_1.py`, `dni_school_report_merge.py` 등.
- **시트 구조 참고**: `src/measure/CNE/TOTAL_MEASURE_LIST_구조확인.txt`, `docs/02_통합DB_실데이터_시트_정의.md`.
- **충남 TOTAL 소스 정의**: `src/measure/build_total_measure_list_v1_1.py`의 `SOURCES` 리스트.

이 기획서를 바탕으로 “다른 데이터도 넣을 수 있는 대화형 프로그램”의 범위와 단계를 정하고, 다음 구현 단계에서 상세 설계·코드화를 진행하면 됩니다.
